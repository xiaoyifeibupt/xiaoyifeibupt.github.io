---
layout: post
title:  C++新特性中的对象移动
categories: [c++]
---

C++中很多情况下都会发生对象拷贝，在其中某些情况下，对象拷贝之后就立即销毁了。在这些情况下，移动而非拷贝对象会大幅度提升性能。

###右值引用

左值和右值都是针对表达式而言的，左值是指表达式结束后依然存在的持久对象，右值是指表达式结束时就不再存在的临时对象。一个区分左值与右值的便捷方法是：看能不能对表达式取地址，如果能，则为左值，否则为右值。

-   赋值操作符需要一个（非常量）左值作为其左侧运算对象，得到的结果也仍然是一个左值
-   取地址符作用于一个左值运算对象，返回一个指向该运算对象的指针，这个指针是一个右值
-   内置解引用运算符、下标运算符、迭代器解引用运算符，string和vector的下标运算符的求值结果都是左值
-   内置类型和迭代器的递增递减运算符作用于左值运算对象、其前置版本所得的结果也是左值

一个左值表达式的求值结果是一个对象或者一个函数；当对象被用作右值的时候，用的是对象的值（内容），当对象被用作左值的时候，用的是对象的身份（在内存中的位置）。

**左值持久，右值短暂**，左值有持久的状态，右值要么是字面值常量，要么是在表达式求职过程中创建的临时对象

右值引用只能绑定到临时对象（所引用的对象将要被销毁，该对象没有其他用户），使用右值引用的代码可以自由地接管所引用的对象的资源。

**变量是左值**

**标准库move函数**，可以显示的将一个左值转换为对应的右值引用类型


###移动构造函数和移动赋值运算符

```cpp
Socket::Socket(Socket&& rhs) : 
		sockfd(std::move(rhs.sockfd)), 
		addr(rhs.addr), 
		host(rhs.host), 
		port(rhs.port) {
	rhs.sockfd = 0;
}
```



